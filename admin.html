<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Portal - C2 Tennis Academy</title>

  <style>
    html, body { height: 100%; margin: 0; display: flex; flex-direction: column; font-family: Arial, sans-serif; }
    header, footer { background-color: #0c3c78; color: white; text-align: center; padding: 20px; }
    nav { background-color: #092e5e; display: flex; justify-content: center; }
    nav a { color: white; padding: 14px 20px; text-decoration: none; }
    nav a:hover { background-color: #0f4fa0; }
    section { flex: 1; padding: 40px 20px; max-width: 1400px; width: 90%; margin: auto; background: white; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    h2 { color: #0c3c78; }
    form { margin-top: 30px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .full-width { grid-column: 1 / -1; }
    label { display: block; font-weight: bold; color: #0c3c78; margin-bottom: 5px; }
    input, select, button { width: 100%; padding: 10px; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box; }
    button { background-color: #0c3c78; color: white; cursor: pointer; grid-column: 1 / -1; margin-top: 20px; }
    button:hover { background-color: #0f4fa0; }
    #student-name-container { display: none; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 8px; border:1px solid #ddd; }
    thead th { background: #0c3c78; color: white; }
  </style>
</head>
<body>

  <header>
    <h1>C2 Tennis Academy</h1>
    <p>Admin Portal: Welcome Admin</p>
  </header>

  <nav>
    <a href="index.html">Home</a>
    <a href="about.html">About</a>
    <a href="programs.html">Programs</a>
    <a href="schedule.html">Schedule</a>
    <a href="contact.html">Contact</a>
  </nav>

  <section>
    <h2>Add / Edit Lesson</h2>
    <form id="lesson-form">
      <input type="hidden" id="lesson-id" />

      <!-- Program -->
      <div class="full-width">
        <label for="program">Program</label>
        <select id="program" required>
          <option value="" disabled selected>Choose a program</option>
          <option>Private Lessons</option>
          <option>Summer Camp / Group Lessons</option>
          <option>High Performance Training</option>
          <option>Adult Clinics</option>
        </select>
      </div>

      <!-- Student (for Private Lessons) -->
      <div id="student-name-container" class="full-width">
        <label for="student-name">Student Name</label>
        <input type="text" id="student-name" placeholder="Enter student name for private lesson" />
      </div>

      <!-- Coach -->
      <div>
        <label for="coach">Coach</label>
        <select id="coach" required>
          <option value="" disabled selected>Choose a coach</option>
          <option>Ricardo Carvajalino</option>
          <option>Jacob Capone</option>
          <option>Zach Capone</option>
          <option>Matthew Abbey</option>
        </select>
      </div>

      <!-- Date -->
      <div>
        <label for="date">Date</label>
        <input type="date" id="date" required />
      </div>

      <!-- Time -->
      <div>
        <label for="time">Time</label>
        <input type="time" id="time" required />
      </div>

      <button type="submit">Save Lesson</button>
    </form>

    <!-- All Scheduled Lessons -->
    <h2>All Scheduled Lessons</h2>
    <div id="all-lessons-container"></div>
  </section>

  <footer>
    <p>&copy; 2025 C2 Tennis Academy. All rights reserved.</p>
  </footer>

  <script>
    // Toggle student field
    const programEl = document.getElementById('program');
    const studentDiv = document.getElementById('student-name-container');
    programEl.addEventListener('change', () => {
      studentDiv.style.display = programEl.value === 'Private Lessons' ? 'block' : 'none';
    });

    // Submit new lesson
    document.getElementById('lesson-form').addEventListener('submit', async e => {
      e.preventDefault();
      const payload = {
        program: programEl.value,
        coachName: document.getElementById('coach').value,
        date: document.getElementById('date').value,
        time: document.getElementById('time').value,
        student: document.getElementById('student-name').value || ''
      };
      const res = await fetch('/api/admin/lessons', {
        method: 'POST',
        credentials: 'include',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      if (res.ok) {
        alert('Lesson saved');
        loadAllLessons();
        e.target.reset();
        studentDiv.style.display = 'none';
      } else {
        alert('Save failed: ' + await res.text());
      }
    });
  </script>

  <script>
    // Load and render all bookings
    async function loadAllLessons() {
      try {
        const res = await fetch('/api/admin/lessons', { credentials: 'include' });
        if (!res.ok) throw new Error(res.status + ': ' + await res.text());
        const lessons = await res.json();
        const c = document.getElementById('all-lessons-container');

        if (!lessons.length) {
          c.innerHTML = '<p>No lessons scheduled yet.</p>';
          return;
        }

        let html = `
          <table>
            <thead>
              <tr>
                <th>Program</th><th>Coach</th><th>Date</th><th>Time</th><th>Student</th><th>Paid?</th><th>Actions</th>
              </tr>
            </thead><tbody>
        `;
        lessons.forEach(l => {
          html += `
            <tr>
              <td>${l.program}</td>
              <td>${l.coach}</td>
              <td>${new Date(l.date).toLocaleDateString()}</td>
              <td>${l.time}</td>
              <td>${l.student || 'â€”'}</td>
              <td>${l.paid ? 'Yes' : 'No'}</td>
              <td><button onclick="deleteAdminLesson(${l.id})">Delete</button></td>
            </tr>
          `;
        });
        html += '</tbody></table>';
        c.innerHTML = html;
      } catch (err) {
        console.error('Load admin lessons error:', err);
        document.getElementById('all-lessons-container')
          .innerHTML = '<p style="color:red;">Could not load lessons.</p>';
      }
    }
    window.addEventListener('DOMContentLoaded', loadAllLessons);

    // Delete handler
    async function deleteAdminLesson(id) {
      if (!confirm('Delete this booking?')) return;
      const res = await fetch(`/api/admin/lessons/${id}`, {
        method: 'DELETE',
        credentials: 'include'
      });
      if (res.ok) loadAllLessons();
      else alert('Delete failed: ' + await res.text());
    }
  </script>
</body>
</html>