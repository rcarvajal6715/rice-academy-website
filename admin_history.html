<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lesson History - Admin Portal - C2 Tennis Academy</title>

  <style>
    html, body { height: 100%; margin: 0; display: flex; flex-direction: column; font-family: Arial, sans-serif; }
    header, footer { background-color: #0c3c78; color: white; text-align: center; padding: 20px; }
    nav { background-color: #092e5e; display: flex; justify-content: center; }
    nav a { color: white; padding: 14px 20px; text-decoration: none; }
    nav a:hover { background-color: #0f4fa0; }
    section { flex: 1; padding: 40px 20px; max-width: 1400px; width: 90%; margin: auto; background: white; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    h2 { color: #0c3c78; }
    /* Form styles removed as form is removed from this page */
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 8px; border:1px solid #ddd; }
    thead th { background: #0c3c78; color: white; }
/* === Global Header & Navigation Styles (Finalized Version) === */
     header {
       background-color: #0c3c78; 
       color: white; 
       padding: 30px 20px; 
       position: relative; 
       text-align: center; 
     }
     .header-content { 
       display: flex; justify-content: center; align-items: center; 
       max-width: 1200px; margin: 0 auto;
       position: relative; 
     }
     .site-title { text-align: center; } 
     .site-title h1 { 
       font-size: 2.2em;    
       margin-top: 0;
       margin-bottom: 0; 
       color: white; 
     } 
     .site-title p { 
       font-size: 1em;    
       margin-top: 0;
       margin-bottom: 0;
       color: #f0f0f0;
     }
     
     .mobile-menu-toggle { display: none; background: none; border: none; color: white; font-size: 28px; cursor: pointer; padding: 5px; }
     nav.main-navigation { background-color: #092e5e; }
     .nav-wrapper-desktop { 
         display: flex; justify-content: center; align-items: center;
         width: 100%; max-width: 1200px; margin: 0 auto; padding: 0 20px; box-sizing: border-box;
     }
     ul.nav-links-desktop { list-style: none; margin: 0; padding: 0; display: flex; }
     ul.nav-links-desktop li a { color: white; padding: 14px 20px; text-decoration: none; display: block; } 
     ul.nav-links-desktop li a:hover { background-color: #0f4fa0; }
     ul.nav-links-desktop li a.highlighted-nav, ul.nav-links-desktop li a.current-page { 
        background-color: #d8f352; color: black; font-weight: bold; border-radius: 5px; 
     }
     ul.nav-links-desktop li a.highlighted-nav:hover, ul.nav-links-desktop li a.current-page:hover { background-color: #c1da3b; }
     
     .auth-buttons-desktop { 
       position: absolute;
       top: 20px; 
       right: 20px; 
       display: flex;
       align-items: center;
       gap: 15px; 
     }
     .auth-buttons-desktop a button, .auth-buttons-desktop button {
       background-color: white; color: #0c3c78; border: none; padding: 10px 20px; 
       border-radius: 5px; font-weight: bold; cursor: pointer;
       transition: all 0.3s ease; white-space: nowrap;
     }
     .auth-buttons-desktop a button:hover, .auth-buttons-desktop button:hover { background-color: #0f4fa0; color: white; }
     .mobile-menu-container {
       display: none; background-color: #092e5e; position: fixed;
       top: 0; left: 0; width: 100%; height: 100%;
       z-index: 1000; padding-top: 20px;
       box-sizing: border-box; overflow-y: auto; text-align: center;
     }
     nav.main-navigation.mobile-menu--open .mobile-menu-container { display: block; }
     .mobile-menu-close {
        display: block; 
        position: absolute; 
        top: 10px; 
        right: 10px; 
        left: auto; 
        bottom: auto; 
        background: none; 
        border: none; 
        color: white; 
        font-size: 28px; 
        cursor: pointer;
        z-index: 10; 
     }
     ul.nav-links-mobile { list-style: none; padding: 0; margin: 50px 0 20px; }
     ul.nav-links-mobile li a {
       color: white; padding: 15px 20px; text-decoration: none; display: block;
       border-bottom: 1px solid #0c3c78;
     }
     ul.nav-links-mobile li:last-child a { border-bottom: none; }
     ul.nav-links-mobile li a:hover { background-color: #0f4fa0; }
     .auth-buttons-mobile { padding: 20px; }
     .auth-buttons-mobile a button, .auth-buttons-mobile button {
       background-color: #d8f352; color: #0c3c78; border: none; padding: 12px 20px;
       border-radius: 5px; font-weight: bold; cursor: pointer; display: block;
       width: 80%; max-width: 250px; margin: 10px auto; box-sizing: border-box;
     }
     .auth-buttons-mobile a button:hover, .auth-buttons-mobile button:hover { background-color: #c1da3b; }
     
     footer { 
        background-color: #0c3c78; color: white; text-align: center; padding: 20px; margin-top:auto; 
     }

     @media (max-width: 768px) {
       body { -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; } 
       header { padding: 10px 15px; } 
       .header-content {
         justify-content: space-between; 
         width:100%; 
       }
       .site-title { text-align: left; }
       .site-title h1 { font-size: 1.2em; margin-bottom: 0; }
       .site-title p { display: none; } 
       .mobile-menu-toggle { display: block; }
       .nav-wrapper-desktop { display: none; }
       .auth-buttons-desktop { display: none; } 
       nav.main-navigation { padding: 0; background-color: transparent; }
      h2 {
        margin-bottom: 20px; 
      }
      section {
        padding: 20px 10px; 
      }
    }
ul.nav-links-desktop li a.highlighted-nav {
  border-radius: 9999px;
}
ul.nav-links-mobile li a.highlighted-nav {
  border-radius: 9999px;
}
ul.nav-links-desktop li a {
  border-radius: 9999px;
}
ul.nav-links-desktop li a.highlighted-nav {
  border-radius: 9999px;
}
ul.nav-links-mobile li a {
  border-radius: 9999px;
}

.explore-button {
  font-family: Arial, sans-serif;
  font-size: 1rem;
  font-weight: 400;
  background-color: #3b82f6; 
  color: white !important; 
  padding: 0.75rem 2rem;
  border: none;
  border-radius: 9999px; 
  box-shadow:
    0 10px 15px -3px rgba(0, 0, 0, 0.1),
    0   4px  6px -2px rgba(0, 0, 0, 0.05);
  cursor: pointer;
  transform-origin: center center;
  transition: background-color 0.2s ease, transform 0.2s ease;
  text-decoration: none; 
  display: inline-block; 
  text-align: center;
  margin-top: 30px; 
}

.explore-button:hover {
  background-color: #2563eb; 
  transform: scale(1.05);
  color: white !important;
  text-decoration: none;
}

.category-filter-button {
  background-color: #f0f0f0; /* Light grey background */
  color: #333;             /* Dark text */
  border: 1px solid #ccc;
  padding: 8px 15px;
  margin: 0 5px 10px 0; /* Margin for spacing */
  border-radius: 5px;
  cursor: pointer;
  font-size: 0.9rem;
  transition: background-color 0.2s ease, color 0.2s ease;
}
.category-filter-button:hover {
  background-color: #e0e0e0; /* Slightly darker grey on hover */
}
.category-filter-button.active-filter-button {
  background-color: #0c3c78; /* Admin blue for active */
  color: white;
  border-color: #0c3c78;
  font-weight: bold;
}
#category-filters-title {
    margin-top: 20px;
    margin-bottom: 10px;
    font-weight: bold;
    color: #0c3c78; /* Match other labels */
}
  </style>
</head>
<body>

<header>
  <div class="header-content">
    <div class="site-title">
      <h1>Lesson History</h1> 
      <p>C2 Tennis Academy</p> 
    </div>
    <button class="mobile-menu-toggle" aria-label="Open navigation menu" aria-expanded="false" aria-controls="mainNavigation">
      &#9776; 
    </button>
  </div>
  <div class="auth-buttons-desktop" id="authContainerDesktop">
  </div>
</header>

<nav class="main-navigation" id="mainNavigation">
  <div class="nav-wrapper-desktop"> 
     <ul class="nav-links-desktop">
       <li><a href="index.html">Home</a></li>
       <li><a href="about.html">About</a></li>
       <li><a href="programs.html">Programs</a></li>
       <li><a href="schedule.html">Schedule</a></li>
       <li><a href="contact.html">Contact</a></li>
     </ul>
  </div>
  <div class="mobile-menu-container">
    <button class="mobile-menu-close" aria-label="Close navigation menu">&times;</button>
    <ul class="nav-links-mobile">
      <li><a href="index.html">Home</a></li>
      <li><a href="about.html">About</a></li>
      <li><a href="programs.html">Programs</a></li>
      <li><a href="schedule.html">Schedule</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
    <div class="auth-buttons-mobile" id="authContainerMobile">
    </div>
  </div>
</nav>

  <section>
    <h2>Past Lesson History</h2>
    <div style="margin-bottom: 20px; margin-top: 10px;">
      <label for="historySearchInput" style="margin-right: 10px; font-weight: bold;">Search Past Lessons:</label>
      <input type="text" id="historySearchInput" placeholder="Enter keyword (student, program, coach, email, date)..." style="width: 50%; padding: 8px;">
    </div>
    <div id="category-filters-title">Filters:</div>
    <div id="category-filters" style="margin-bottom: 20px;">
      <button class="category-filter-button active-filter-button" data-category="All">All</button>
      <button class="category-filter-button" data-category="Privates">Private Lessons</button>
      <button class="category-filter-button" data-category="Camps">Camps & Passes</button>
      <button class="category-filter-button" data-category="Clinics">Clinics & Other</button>
    </div>
    <div id="past-lessons-table-container" style="margin-top: 20px;">
        <!-- The single table of past lessons will be rendered here by JavaScript -->
    </div>
  </section>

  <footer>
    <p>&copy; 2025 C2 Tennis Academy. All rights reserved.</p>
  </footer>

  <script>
  // This script block is intentionally left empty as the form-related JS was removed.
  </script>

  <script>
  let allFetchedPastLessons = []; 
  let activeCategoryFilter = 'All'; // Default active filter

  function formatTime_12hr(timeStr) {
    if (!timeStr || !timeStr.includes(':')) {
      return timeStr; 
    }
    const parts = timeStr.split(':');
    let hours = parseInt(parts[0], 10);
    const minutes = parseInt(parts[1], 10);
    
    const ampm = hours >= 12 ? 'PM' : 'AM';
    hours = hours % 12;
    hours = hours ? hours : 12; 
    
    const minutesStr = minutes < 10 ? '0' + minutes : minutes;
    
    return hours + ':' + minutesStr + ' ' + ampm;
  }

  function renderLessonsTable(lessonsArray, containerId, placeholderMessage) {
    console.log('HISTORY.HTML: renderLessonsTable START for container:', containerId, 'with lessons:', lessonsArray.length);
    const coachColors = { 
        'Ricardo Carvajalino': '#e0f7fa', 
        'Jacob Capone': '#fff9c4',      
        'Zach Capone': '#c8e6c9',        
        'Zachary Capone': '#c8e6c9',     
        'Matthew Abbey': '#ffccbc',     
        'Paula Carvajalino': '#f3e5f5'  
    };
    const container = document.getElementById(containerId);
    if (!container) {
      console.error('Container not found for ID:', containerId);
      return;
    }

    if (lessonsArray.length === 0) {
      console.log('HISTORY.HTML: Rendering placeholder for:', containerId);
      container.innerHTML = `<p>${placeholderMessage}</p>`;
      return;
    }

    let html = `
      <table style="width:100%; border-collapse:collapse; margin-top:10px;">
        <thead>
          <tr style="background:#0c3c78; color:white;">
            <th style="padding:8px; border:1px solid #ddd;">Program</th>
            <th style="padding:8px; border:1px solid #ddd;">Coach</th>
            <th style="padding:8px; border:1px solid #ddd;">Date</th>
            <th style="padding:8px; border:1px solid #ddd;">Time</th>
            <th style="padding:8px; border:1px solid #ddd;">Student</th>
            <th style="padding:8px; border:1px solid #ddd;">Email</th>
            <th style="padding:8px; border:1px solid #ddd;">Phone</th>
            <th style="padding:8px; border:1px solid #ddd;">Paid?</th>
            <th style="padding:8px; border:1px solid #ddd;">Actions</th>
          </tr>
        </thead>
        <tbody>
    `;

    lessonsArray.forEach(les => {
      const dateStr = new Date(les.date).toLocaleDateString();
      const paidText = les.paid ? 'Yes' : '<strong style="color: red;">NO - Pay Later</strong>';
      const formattedTime = formatTime_12hr(les.time);
      
      let rowStyle = '';
      if (!les.paid) {
          rowStyle = 'background-color: #ffebee;'; 
      }

      html += `
        <tr data-id="${les.id}" ${rowStyle ? `style="${rowStyle}"` : ''}>
          <td style="padding:8px; border:1px solid #ddd;">${les.program}</td>
          <td style="padding:8px; border:1px solid #ddd;">${les.coach}</td>
          <td style="padding:8px; border:1px solid #ddd;">${dateStr}</td>
          <td style="padding:8px; border:1px solid #ddd;">${formattedTime}</td>
          <td style="padding:8px; border:1px solid #ddd;">${les.student || '—'}</td>
          <td style="padding:8px; border:1px solid #ddd;">${les.email || '—'}</td>
          <td style="padding:8px; border:1px solid #ddd;">${les.phone || '—'}</td>
          <td style="padding:8px; border:1px solid #ddd;">${paidText}</td>
          <td style="padding:8px; border:1px solid #ddd;">
            <button onclick="deleteAdminLesson(${les.id})">Delete</button>
          </td>
        </tr>
      `;
    });

    html += `</tbody></table>`;
    container.innerHTML = html;
    console.log('HISTORY.HTML: Rendering actual table into:', containerId, 'HTML length:', html.length > 0 ? html.length : 'EMPTY!');
  }

  async function loadPastLessons() {
    const res = await fetch('/api/admin/lessons', { credentials: 'include' });
    if (!res.ok) {
      const errorMsg = '<p style="color:red;">Could not load lessons data.</p>';
      document.getElementById('private-lessons-table-container').innerHTML = errorMsg;
      document.getElementById('camp-lessons-table-container').innerHTML = errorMsg;
      document.getElementById('clinic-lessons-table-container').innerHTML = errorMsg;
      document.getElementById('other-bookings-table-container').innerHTML = errorMsg;
      return;
    }
    const lessons = await res.json();
    console.log('HISTORY.HTML: Fetched total lessons:', lessons.length, lessons.slice(0,2));

    const now = new Date();
    const pastLessons = lessons.filter(les => {
        if (!les.date) return false; 
        const dateStr = les.date.substring(0, 10); 
        const dateParts = dateStr.split('-');
        if (dateParts.length !== 3) return false; 

        const year = parseInt(dateParts[0]);
        const month = parseInt(dateParts[1]) - 1; 
        const day = parseInt(dateParts[2]);

        let hours = 23, minutes = 59, seconds = 59; 
        if (les.time) {
            const timeParts = les.time.split(':');
            if (timeParts.length >= 2) {
                hours = parseInt(timeParts[0]);
                minutes = parseInt(timeParts[1]);
                seconds = timeParts[2] ? parseInt(timeParts[2]) : 0;
            }
        }

        try {
            const lessonDate = new Date(year, month, day, hours, minutes, seconds);
            if (lessonDate.toDateString() === now.toDateString()) { 
                return lessonDate < now; 
            }
            return lessonDate < now; 
        } catch (e) {
            console.error(`HISTORY.HTML: Invalid date components for lesson: Y:${year} M:${month} D:${day} H:${hours} M:${minutes}`, les, e);
            return false;
        }
    });
    console.log('HISTORY.HTML: Filtered past lessons count:', pastLessons.length, pastLessons.slice(0,2));

    allFetchedPastLessons = [...pastLessons]; 
    console.log('HISTORY.HTML: Stored allFetchedPastLessons:', allFetchedPastLessons.length);
    
    filterAndRenderHistory(''); 
  }

  async function deleteAdminLesson(id) {
    if (!confirm('Are you sure you want to delete this lesson?')) return;
    const res = await fetch(`/api/admin/lessons/${id}`, {
      method: 'DELETE',
      credentials: 'include'
    });
    if (res.ok) {
      loadPastLessons(); 
    } else {
      alert('Delete failed: ' + await res.text());
    }
  }
  
  function filterAndRenderHistory(searchTerm) {
    let searchFilteredLessons; // Lessons filtered by search term first
    if (!searchTerm) {
        searchFilteredLessons = [...allFetchedPastLessons]; 
    } else {
        searchFilteredLessons = allFetchedPastLessons.filter(les => {
            const dateStr = new Date(les.date).toLocaleDateString().toLowerCase();
            return (
                (les.program && les.program.toLowerCase().includes(searchTerm)) ||
                (les.coach && les.coach.toLowerCase().includes(searchTerm)) ||
                (les.student && les.student.toLowerCase().includes(searchTerm)) ||
                (les.email && les.email.toLowerCase().includes(searchTerm)) ||
                (dateStr.includes(searchTerm)) ||
                (les.phone && les.phone.toLowerCase().includes(searchTerm))
            );
        });
    }
    console.log('HISTORY.HTML: Searched/Filtered lessons count:', searchFilteredLessons.length, 'for term:', searchTerm);

    let lessonsToCategorize; // Lessons to be fed into categorization logic
    if (activeCategoryFilter === 'All') {
        lessonsToCategorize = [...searchFilteredLessons];
    } else {
        lessonsToCategorize = searchFilteredLessons.filter(les => {
            const programName = les.program ? les.program.toLowerCase() : '';
            if (activeCategoryFilter === 'Privates') {
                return programName.includes('private') || programName.includes('tennis private');
            } else if (activeCategoryFilter === 'Camps') {
                return programName.includes('camp') || programName.includes('pass');
            } else if (activeCategoryFilter === 'Clinics') {
                return programName.includes('clinic') || programName.includes('high performance');
            }
            return false; 
        });
    }
    // console.log('HISTORY.HTML: Lessons after category filter:', lessonsToCategorize.length, 'for category:', activeCategoryFilter);


    const privateLessons = [];
    const campLessons = [];
    const clinicLessons = [];
    const otherBookings = [];

    // Categorize based on lessonsToCategorize
    if (activeCategoryFilter === 'All') {
        lessonsToCategorize.forEach(les => {
            const programName = les.program ? les.program.toLowerCase() : '';
            if (programName.includes('private') || programName.includes('tennis private')) {
                privateLessons.push(les);
            } else if (programName.includes('camp') || programName.includes('pass')) {
                campLessons.push(les);
            } else if (programName.includes('clinic') || programName.includes('high performance')) {
                clinicLessons.push(les);
            } else {
                otherBookings.push(les);
            }
        });
    } else if (activeCategoryFilter === 'Privates') {
        lessonsToCategorize.forEach(les => privateLessons.push(les));
    } else if (activeCategoryFilter === 'Camps') {
        lessonsToCategorize.forEach(les => campLessons.push(les));
    } else if (activeCategoryFilter === 'Clinics') {
        lessonsToCategorize.forEach(les => clinicLessons.push(les));
    }
    
    console.log('HISTORY.HTML: Final Categorized - Private:', privateLessons.length, 
                'Camps:', campLessons.length, 
                'Clinics:', clinicLessons.length, 
                'Other:', otherBookings.length,
                'based on active filter:', activeCategoryFilter);

    const privateSection = document.getElementById('private-lessons-section');
    if (privateLessons.length > 0 || (activeCategoryFilter === 'All' && searchTerm === '')) { // Show section if 'All' or has items
        privateSection.style.display = 'block';
        renderLessonsTable(privateLessons, 'private-lessons-table-container', 'No matching private lessons found.');
    } else if (privateLessons.length === 0 && activeCategoryFilter === 'Privates') {
        privateSection.style.display = 'block'; // Show section to display placeholder
        renderLessonsTable(privateLessons, 'private-lessons-table-container', 'No matching private lessons found.');
    }
    else {
        privateSection.style.display = 'none';
        document.getElementById('private-lessons-table-container').innerHTML = ''; 
    }

    const campSection = document.getElementById('camp-lessons-section');
    if (campLessons.length > 0 || (activeCategoryFilter === 'All' && searchTerm === '')) {
        campSection.style.display = 'block';
        renderLessonsTable(campLessons, 'camp-lessons-table-container', 'No matching camp or pass lessons found.');
    } else if (campLessons.length === 0 && activeCategoryFilter === 'Camps') {
        campSection.style.display = 'block';
        renderLessonsTable(campLessons, 'camp-lessons-table-container', 'No matching camp or pass lessons found.');
    }
     else {
        campSection.style.display = 'none';
        document.getElementById('camp-lessons-table-container').innerHTML = '';
    }

    const clinicSection = document.getElementById('clinic-lessons-section');
    if (clinicLessons.length > 0 || (activeCategoryFilter === 'All' && searchTerm === '')) {
        clinicSection.style.display = 'block';
        renderLessonsTable(clinicLessons, 'clinic-lessons-table-container', 'No matching clinic lessons found.');
    } else if (clinicLessons.length === 0 && activeCategoryFilter === 'Clinics') {
        clinicSection.style.display = 'block';
        renderLessonsTable(clinicLessons, 'clinic-lessons-table-container', 'No matching clinic lessons found.');
    }
     else {
        clinicSection.style.display = 'none';
        document.getElementById('clinic-lessons-table-container').innerHTML = '';
    }

    const otherSection = document.getElementById('other-bookings-section');
    // Show 'Other' only if 'All' is selected and it has items, or if it's specifically filtered to 'Other' (if such a filter existed)
    if (activeCategoryFilter === 'All' && otherBookings.length > 0) {
        otherSection.style.display = 'block';
        renderLessonsTable(otherBookings, 'other-bookings-table-container', 'No other matching bookings found.');
    } else {
        otherSection.style.display = 'none';
        document.getElementById('other-bookings-table-container').innerHTML = '';
    }
  }

  window.addEventListener('DOMContentLoaded', () => {
    loadPastLessons(); 

    const searchInput = document.getElementById('historySearchInput');
    if (searchInput) {
        searchInput.addEventListener('input', () => {
            const searchTerm = searchInput.value.toLowerCase().trim();
            filterAndRenderHistory(searchTerm);
        });
    }

    const filterButtons = document.querySelectorAll('#category-filters .category-filter-button');
    filterButtons.forEach(button => {
        button.addEventListener('click', () => {
            activeCategoryFilter = button.getAttribute('data-category');
            
            filterButtons.forEach(btn => btn.classList.remove('active-filter-button'));
            button.classList.add('active-filter-button');
            
            const currentSearchTerm = searchInput ? searchInput.value.toLowerCase().trim() : '';
            filterAndRenderHistory(currentSearchTerm); 
        });
    });
  });
</script>
  <script>
  // This entire block to be added as a new script, or integrated if a single DOMContentLoaded is preferred.
  document.addEventListener('DOMContentLoaded', () => {
      // --- Mobile Menu Toggle Script --- 
      const menuToggle = document.querySelector('.mobile-menu-toggle');
      const mobileMenuClose = document.querySelector('.mobile-menu-close');
      const mainNav = document.querySelector('nav.main-navigation');

      if (menuToggle && mainNav && mobileMenuClose) {
          menuToggle.addEventListener('click', () => {
              const isMenuOpen = mainNav.classList.toggle('mobile-menu--open');
              menuToggle.setAttribute('aria-expanded', isMenuOpen);
              if (isMenuOpen) {
                  menuToggle.innerHTML = '&times;'; 
                  menuToggle.setAttribute('aria-label', 'Close navigation menu');
              } else {
                  menuToggle.innerHTML = '&#9776;'; 
                  menuToggle.setAttribute('aria-label', 'Open navigation menu');
              }
          });

          mobileMenuClose.addEventListener('click', () => {
              mainNav.classList.remove('mobile-menu--open');
              if (menuToggle) {
                 menuToggle.setAttribute('aria-expanded', 'false');
                 menuToggle.innerHTML = '&#9776;'; 
                 menuToggle.setAttribute('aria-label', 'Open navigation menu');
              }
          });
      }

      const mobileNavLinks = document.querySelectorAll('.mobile-menu-container a');
      if (mainNav && mobileNavLinks.length > 0) {
          mobileNavLinks.forEach(link => {
              link.addEventListener('click', () => {
                  if (mainNav.classList.contains('mobile-menu--open')) {
                      mainNav.classList.remove('mobile-menu--open');
                      if (menuToggle) {
                          menuToggle.setAttribute('aria-expanded', 'false');
                          menuToggle.innerHTML = '&#9776;';
                          menuToggle.setAttribute('aria-label', 'Open navigation menu');
                      }
                  }
              });
          });
      }

      // --- checkSession and logout functions for Admin Portal --- 
      async function checkSession() {
          const existingGreeting = document.querySelector('.welcome-greeting');
          if (existingGreeting) existingGreeting.remove();
           
          try {
              const res = await fetch('/api/check-session', { credentials: 'include' });
              const data = await res.json(); 

              const authContainerDesktop = document.getElementById('authContainerDesktop');
              const authContainerMobile = document.getElementById('authContainerMobile');
              
              if (data && data.loggedIn === true && data.isAdmin === true) {
                  const portalButtonText = data.firstName ? 'Admin (' + data.firstName + ')' : 'Admin Portal';
                  
                  const loggedInHTML = '<a href="admin.html"><button>' + portalButtonText + '</button></a><button onclick="logout()">Logout</button>';
                  const loggedInMobileHTML = loggedInHTML; 

                  if (authContainerDesktop) authContainerDesktop.innerHTML = loggedInHTML;
                  if (authContainerMobile) authContainerMobile.innerHTML = loggedInMobileHTML;

                  const welcomeMessageText = data.firstName ? 'Welcome, ' + data.firstName + '!' : 'Welcome, Admin!';
                  
                  const greeting = document.createElement('div');
                  greeting.className = 'welcome-greeting';
                  greeting.textContent = welcomeMessageText;
                  greeting.style.cssText = 'background:#0c3c78;color:white;padding:10px;text-align:center;font-weight:bold;';
                  
                  const existingGreeting = document.querySelector('.welcome-greeting');
                  if (existingGreeting) existingGreeting.remove();

                  if(document.body.firstChild) { 
                      document.body.insertBefore(greeting, document.body.firstChild);
                  } else { 
                      document.body.appendChild(greeting);
                  }
              } else {
                  window.location.href = 'login.html'; 
                  const loggedOutHTML = `<a href="login.html"><button>Login</button></a>`;
                  if (authContainerDesktop) authContainerDesktop.innerHTML = loggedOutHTML;
                  if (authContainerMobile) authContainerMobile.innerHTML = loggedOutHTML;
              }
          } catch (err) {
              console.error('Session check failed, redirecting to login:', err);
              window.location.href = 'login.html'; 
              const authContainerDesktop = document.getElementById('authContainerDesktop');
              const authContainerMobile = document.getElementById('authContainerMobile');
              const loggedOutHTML = `<a href="login.html"><button>Login</button></a>`;
              if (authContainerDesktop) authContainerDesktop.innerHTML = loggedOutHTML;
              if (authContainerMobile) authContainerMobile.innerHTML = loggedOutHTML;
          }
      }

      window.logout = function() { 
          fetch('/api/logout', { method: 'POST', credentials: 'include' })
              .then(() => {
                  const existingGreeting = document.querySelector('.welcome-greeting');
                  if (existingGreeting) existingGreeting.remove();
                  document.cookie = "userFirstName=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                  window.location.href = 'login.html'; 
              });
      }

      checkSession(); 
  });
  </script>
</body>
</html>