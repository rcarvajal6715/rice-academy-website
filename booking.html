
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Book a Session - C2 Tennis Academy</title>
  <meta name="description" content="C2 Tennis Academy in Texas offers elite tennis training, junior programs, and high-performance coaching using AI and video analysis.">
  <meta name="keywords" content="C2 Tennis Academy, tennis lessons Texas, UTR tennis, junior tennis, adult clinics, tennis training academy">
  <meta name="author" content="C2 Tennis Academy">
  <meta property="og:title" content="C2 Tennis Academy | Elite Tennis Training in Texas">
  <meta property="og:description" content="Boost your UTR with expert coaching, AI video feedback, and elite tennis programs at C2 Tennis Academy.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://c2tennisacademy.com/">

  <!-- Flatpickr CSS -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
  <style>
    html, body {
      /* height: 100%; Ensure this doesn't conflict if booking page content is long */
      margin: 0;
      display: flex;
      flex-direction: column;
      font-family: Arial, sans-serif;
    }
    main {
      flex: 1; /* Allows footer to stick to bottom if content is short */
    }
    footer {
      background-color: #0c3c78;
      color: white;
      text-align: center;
      padding: 20px;
      /* position: relative; /* Generally not needed unless specific positioning is required */
    }

    /* === Styles from index.html for Header & Navigation === */
    header {
       background-color: #0c3c78; 
       color: white; 
       padding: 30px 20px;
       position: relative; 
       text-align: center; 
     }
     .header-content {
       display: flex; justify-content: center; align-items: center;
       max-width: 1200px; margin: 0 auto;
       position: relative;
     }
     .site-title { text-align: center; }
     .site-title h1 { 
       font-size: 2.2em;
       margin-top: 0;
       margin-bottom: 0.25em; 
       color: white; 
     } 
     .site-title p { 
       font-size: 1em;    
       margin-top: 0;
       margin-bottom: 0;
       color: #f0f0f0;
     }

     .mobile-menu-toggle { display: none; background: none; border: none; color: white; font-size: 28px; cursor: pointer; padding: 5px; }

     nav.main-navigation { background-color: #092e5e; }
     .nav-wrapper-desktop {
         display: flex; justify-content: center; align-items: center;
         width: 100%; max-width: 1200px; margin: 0 auto; padding: 0 20px; box-sizing: border-box;
     }
     ul.nav-links-desktop { list-style: none; margin: 0; padding: 0; display: flex; }
     ul.nav-links-desktop li a { color: white; padding: 14px 20px; text-decoration: none; display: block; }
     ul.nav-links-desktop li a:hover { background-color: #0f4fa0; }
     /* Highlight for "Book" link if needed on booking.html, can be added via class */
     ul.nav-links-desktop li a.highlighted-nav { background-color: #d8f352; color: black; font-weight: bold; border-radius: 5px; }
     ul.nav-links-desktop li a.highlighted-nav:hover { background-color: #c1da3b; }


     .auth-buttons-desktop {
       position: absolute;
       top: 20px; 
       right: 20px; 
       display: flex;
       align-items: center;
     }
     .auth-buttons-desktop a button, .auth-buttons-desktop button,
     .auth-buttons-desktop a.coach-link-button { /* Include coach link button styling here */
       background-color: white; color: #0c3c78; border: none; padding: 10px 20px;
       margin-left: 10px; border-radius: 5px; font-weight: bold; cursor: pointer;
       transition: all 0.3s ease; white-space: nowrap; text-decoration: none; /* For <a> tags */
       display: inline-flex; align-items: center; justify-content: center; /* For proper button appearance on <a> */
     }
     .auth-buttons-desktop a button:hover, .auth-buttons-desktop button:hover,
     .auth-buttons-desktop a.coach-link-button:hover { background-color: #0f4fa0; color: white; }
     
     .auth-buttons-desktop a.coach-link-button { /* Specific override for coach link if needed */
        background-color: #d8f352;
        color: #0c3c78;
     }
     .auth-buttons-desktop a.coach-link-button:hover {
        background-color: #c1da3b;
        color: #0c3c78;
     }


     .mobile-menu-container {
       display: none; background-color: #092e5e; position: fixed;
       top: 0; left: 0; width: 100%; height: 100%;
       z-index: 1000; 
       padding-top: 20px; 
       box-sizing: border-box; overflow-y: auto; text-align: center;
     }
     nav.main-navigation.mobile-menu--open .mobile-menu-container { display: block; }
     .mobile-menu-close {
        display: block; 
        position: absolute;
        top: 15px;
        right: 20px;
        background: none;
        border: none;
        color: white;
        font-size: 28px;
        cursor: pointer;
     }
     ul.nav-links-mobile { list-style: none; padding: 0; margin: 20px 0; }
     ul.nav-links-mobile li a {
       color: white; padding: 15px 20px; text-decoration: none; display: block;
       border-bottom: 1px solid #0c3c78;
     }
     ul.nav-links-mobile li:last-child a { border-bottom: none; }
     ul.nav-links-mobile li a:hover { background-color: #0f4fa0; }

     .auth-buttons-mobile { padding: 20px; }
     .auth-buttons-mobile a button, .auth-buttons-mobile button {
       background-color: #d8f352; color: #0c3c78; border: none; padding: 12px 20px;
       border-radius: 5px; font-weight: bold; cursor: pointer; display: block;
       width: 80%; max-width: 250px; margin: 10px auto; box-sizing: border-box;
       text-decoration: none;
     }
     .auth-buttons-mobile a button:hover, .auth-buttons-mobile button:hover { background-color: #c1da3b; }
     

     @media (max-width: 768px) {
       body { -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; }

       header { padding: 10px 15px; }
       .header-content {
         justify-content: space-between; 
         width:100%; 
       }
       .site-title { text-align: left; }
       .site-title h1 { font-size: 1.2em; margin-bottom: 0; }
       .site-title p { display: none; } 

       .mobile-menu-toggle { display: block; }
       
       .nav-wrapper-desktop { display: none; }
       .auth-buttons-desktop { display: none; }

       nav.main-navigation { padding: 0; background-color: transparent; }
     }

    /* === Styles specific to booking.html === */
    .flatpickr-day.week-highlight {
      background: #0c3c78 !important;
      color: white !important;
      border-radius: 50%;
    }
    section { padding: 40px 20px; } /* Original booking section padding */
    .booking-container {
      max-width: 500px; margin: auto; background: #fff; padding: 30px;
      border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .booking-container h2 { margin-top: 0; color: #0c3c78; }
    label { display: block; margin-top: 15px; font-weight: bold; }
    input, select {
      width: 100%; padding: 10px; margin-top: 5px; box-sizing: border-box;
      border: 1px solid #ccc; border-radius: 5px;
    }
    /* General button style for booking form, distinct from auth buttons */
    .booking-container button[type="submit"] {
      margin-top: 20px; width: 100%; padding: 12px; background-color: #0c3c78;
      color: white; border: none; border-radius: 5px; font-size: 1rem;
      cursor: pointer;
    }
    .booking-container button[type="submit"]:hover { background-color: #0f4fa0; }

    /* Welcome greeting style */
    .welcome-greeting {
        background:#0c3c78;color:white;padding:10px;text-align:center;font-weight:bold;
    }
  /* Override the highlighted “Book” pill to be fully rounded */
ul.nav-links-desktop li a.highlighted-nav {
  border-radius: 9999px;
}

/* If you also want the mobile “Book” link rounded, do: */
ul.nav-links-mobile li a.highlighted-nav {
  border-radius: 9999px;
}
/* Make desktop nav links more pill-shaped */
ul.nav-links-desktop li a {
  border-radius: 9999px;
}

/* Ensure highlighted tab stays pill-shaped */
ul.nav-links-desktop li a.highlighted-nav {
  border-radius: 9999px;
}

/* Make mobile nav links match */
ul.nav-links-mobile li a {
  border-radius: 9999px;
}
  </style>
</head>
<body>

  <header>
    <div class="header-content">
      <div class="site-title">
        <h1>C2 Tennis Academy</h1>
        <p>Developing Champions On and Off the Court</p>
      </div>
      <button class="mobile-menu-toggle" aria-label="Open navigation menu" aria-expanded="false" aria-controls="mainNavigationMobile">
        &#9776; <!-- Hamburger icon -->
      </button>
    </div>
    <div class="auth-buttons-desktop" id="authContainerDesktop">
      <!-- Desktop auth buttons will be populated by JavaScript -->
      <!-- Fallback or initial content if JS is slow/fails -->
      <a href="register.html"><button>Register</button></a>
      <a href="login.html"><button>Login</button></a>
      <a href="about.html#meet-our-coaches" class="coach-link-button">Meet the Coaches</a>
    </div>
  </header>

  <nav class="main-navigation" id="mainNavigationMobile">
    <div class="nav-wrapper-desktop"> 
       <ul class="nav-links-desktop">
         <li><a href="index.html">Home</a></li>
         <li><a href="about.html">About</a></li>
         <li><a href="programs.html">Programs</a></li>
         <li><a href="schedule.html">Schedule</a></li>
         <li><a href="contact.html">Contact</a></li>
         <li><a href="booking.html" class="highlighted-nav">Book</a></li>
       </ul>
    </div>

    <div class="mobile-menu-container">
      <button class="mobile-menu-close" aria-label="Close navigation menu">&times;</button>
      <ul class="nav-links-mobile">
        <li><a href="index.html">Home</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="programs.html">Programs</a></li>
        <li><a href="schedule.html">Schedule</a></li>
        <li><a href="contact.html">Contact</a></li>
        <li><a href="booking.html">Book</a></li>
      </ul>
      <div class="auth-buttons-mobile" id="authContainerMobile">
        <!-- Mobile auth buttons will be populated by JavaScript -->
        <!-- Fallback or initial content -->
        <a href="register.html"><button>Register</button></a>
        <a href="login.html"><button>Login</button></a>
      </div>
    </div>
  </nav>

  <main>
    <section>
      <div class="booking-container">
        <h2>Book a Session</h2>
        <form id="bookingForm">
          <label for="student">Student Name</label>
        <input type="text" id="student" placeholder="Enter student name" required />

          <label for="program">Program</label>
      <select id="program" name="program" required>
          <option value="" disabled selected>Select a program</option>
          <option value="Tennis Private">Tennis Private — $80</option>
         <option value="Summer Camp - Day Pass">Summer Camp - Day Pass — $30</option>
         <option value="Summer Camp - Week Pass">Summer Camp - Week Pass — $130</option>
         <option value="Kids Camp - Day Pass">Kids Camp - Day Pass — $40</option>
         <option value="Kids Camp - Week Pass">Kids Camp - Week Pass — $110</option>
      </select>
          <label for="campDay" id="campDayLabel" style="display:none;">Choose Camp Day</label>
          <input type="text" id="campDay" placeholder="Select a weekday" style="display:none;" readonly />
          <label for="weekStart" id="weekStartLabel" style="display:none;">Select Week Start (Monday only)</label>
          <input type="text" id="weekStart" placeholder="Select a Monday" style="display:none;" readonly />

          <label for="coach" id="coachLabel" style="display:none;">Coach</label>
          <select id="coach" style="display:none;">
            <option value="">-- Select Coach --</option>
            <option value="Ricardo Carvajalino">Ricardo Carvajalino</option>
            <option value="Zachary Capone">Zachary Capone</option>
            <option value="Jacob Capone">Jacob Capone</option>
            <option value="Matthew Abbey">Matthew Abbey</option>
            <option value="Paula Carvajalino">Paula Carvajalino</option>
          </select>

          <label for="date" id="dateLabel" style="display:none;">Preferred Date</label>
          <input type="text" id="date" placeholder="Select a date" style="display:none;" readonly />

          <label for="time" id="timeLabel" style="display:none;">Preferred Time</label>
          <select id="time" style="display:none;"></select>

        <div id="email-container">
          <label for="email">Your Email</label>
          <input type="email" id="email" name="email" required />
        </div>

        <div id="phone-container">
          <label for="phone">Your Phone Number</label>
          <input type="tel" id="phone" name="phone" required />
        </div>

   <div id="payment-options-container">
     <label style="margin-top: 20px; margin-bottom: 10px;">Payment Option</label>
     <div>
       <input type="radio" id="payNow" name="paymentOption" value="payNow" checked style="width: auto; margin-right: 5px;">
       <label for="payNow" style="display: inline; font-weight: normal;">Pay Now (Card)</label>
     </div>
     <div style="margin-top: 5px;">
       <input type="radio" id="payLater" name="paymentOption" value="payLater" style="width: auto; margin-right: 5px;">
       <label for="payLater" style="display: inline; font-weight: normal;">Pay Later (Zelle, Venmo, Cash)</label>
     </div>
   </div>
          <button type="submit" id="submitBookingBtn">Pay &amp; Book</button>
        </form>
      </div>
    </section>
  </main>
  

  <footer>
    <p>&copy; 2025 C2 Tennis Academy. All rights reserved.</p>
  </footer>

  <!-- Flatpickr JS -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

  <script>
// Helper Functions & Availability Map (Unchanged)
function parseTime(str) {
  const [time, mer] = str.split(' ');
  let [h, m] = time.split(':').map(Number);
  if (mer === 'PM' && h < 12) h += 12;
  if (mer === 'AM' && h === 12) h = 0;
  return h * 60 + m;
}
function fmtTime(mins) {
  let h = Math.floor(mins / 60), m = mins % 60;
  const mer = h >= 12 ? 'PM' : 'AM';
  if (h > 12) h -= 12;
  if (h === 0) h = 12;
  return `${h}:${m.toString().padStart(2,'0')} ${mer}`;
}
const availability = {
  'Jacob Capone':        { days: [4,5,6], times: { 4:{min:'3:00 PM',max:'8:00 PM'},5:{min:'3:00 PM',max:'8:00 PM'},6:{min:'8:00 AM',max:'4:00 PM'} } },
  'Zachary Capone':      { days: [1,2,3,4,5,6], times: { default:{min:'9:00 AM',max:'7:00 PM'},6:{min:'9:00 AM',max:'5:00 PM'} } },
  'Ricardo Carvajalino': { days: [1,2,3,4,5,6], times: { default:{min:'8:00 AM',max:'2:00 PM'} } },
  'Paula Carvajalino':   { days: [1,2,3,4,5], times: { default:{min:'9:00 AM',max:'7:00 PM'} } },
  'Matthew Abbey':       { days: [1,2,3,4,5], times: { default:{min:'9:00 AM',max:'7:00 PM'} } }
};
</script>

  <script>
  // Empty script block from original - preserved
</script>

  <script>
  // Main Booking Logic (Unchanged from previous correct version)
  const programEl     = document.getElementById('program');
  const coachEl       = document.getElementById('coach');
  const coachLbl      = document.getElementById('coachLabel');
  const dateEl        = document.getElementById('date');
  const dateLbl       = document.getElementById('dateLabel');
  const timeEl        = document.getElementById('time');
  const timeLbl       = document.getElementById('timeLabel');
  const campDayInput  = document.getElementById('campDay');
  const campDayLabel  = document.getElementById('campDayLabel');
  const weekStartInput  = document.getElementById('weekStart');
  const weekStartLabel  = document.getElementById('weekStartLabel');
  let datePicker = null;

  programEl.addEventListener('change', () => {
    const program    = programEl.value;
    const isCampDay  = program === 'Summer Camp - Day Pass' || program === 'Kids Camp - Day Pass';
    const isCampWeek = program === 'Summer Camp - Week Pass' || program === 'Kids Camp - Week Pass';
    const showCoach  = program === 'Tennis Private';

    coachEl.style.display = showCoach ? 'block' : 'none';
    coachLbl.style.display = showCoach ? 'block' : 'none';
    dateEl.style.display  = showCoach ? 'block' : 'none';
    dateLbl.style.display = showCoach ? 'block' : 'none';
    timeEl.style.display  = showCoach ? 'block' : 'none';
    timeLbl.style.display = showCoach ? 'block' : 'none';

    if (datePicker) {
      datePicker.destroy();
      datePicker = null;
      timeEl.innerHTML = '<option value="">-- Select Time --</option>';
      dateEl.value = '';
    }

    if (isCampDay) {
      campDayLabel.style.display = campDayInput.style.display = 'block';
      setTimeout(() => {
        flatpickr(campDayInput, {
          dateFormat: 'Y-m-d', minDate: 'today',
          disable: [
            ...(program === 'Summer Camp - Day Pass' ? [d => d.getDay() === 0 || d.getDay() === 6] : []),
            ...(program === 'Kids Camp - Day Pass' ? [d => d.getDay() < 1 || d.getDay() > 3] : [])
          ]
        });
      }, 10);
    } else {
      campDayLabel.style.display = campDayInput.style.display = 'none';
      campDayInput.value = '';
    }

    if (isCampWeek) {
      weekStartLabel.style.display = weekStartInput.style.display = 'block';
      setTimeout(() => {
        flatpickr(weekStartInput, {
          dateFormat: 'Y-m-d', minDate: 'today',
          disable: [(date) => date.getDay() !== 1],
          clickOpens: true, allowInput: false
        });
      }, 10);
    } else {
      weekStartLabel.style.display = weekStartInput.style.display = 'none';
      weekStartInput.value = '';
    }
  });

  let blockedDays = [];
  let timeBlocks = [];

  coachEl.addEventListener('change', async () => {
    if (!coachEl.value) return;
    try {
      const res = await fetch(`/api/public-availability?coach=${encodeURIComponent(coachEl.value)}`);
      const data = await res.json();
      blockedDays = data.days || [];
      timeBlocks = data.times || [];
    } catch (err) {
      console.error('❌ Failed to fetch public availability:', err);
      blockedDays = []; timeBlocks = [];
    }

    if (datePicker) datePicker.destroy();
    dateEl.value = '';
    timeEl.innerHTML = '<option value="">-- Select Time --</option>';
    dateLbl.style.display = dateEl.style.display = 'block';
    timeLbl.style.display = timeEl.style.display = 'none';

    const avail = availability[coachEl.value];
    datePicker = flatpickr(dateEl, {
      dateFormat: 'Y-m-d', minDate: 'today',
      disable: [
        d => !avail.days.includes(d.getDay()),
        ...blockedDays.map(d => new Date(d))
      ],
      onChange(selectedDates) {
        const d = selectedDates[0];
        const dow = d.getDay();
        const slot = avail.times[dow] || avail.times.default;
        timeEl.innerHTML = '<option value="">-- Select Time --</option>';
        const selectedDateStr = d.toISOString().split('T')[0];
        const blockedTimesForDate = timeBlocks
          .filter(tb => tb.date === selectedDateStr)
          .map(tb => [parseTime(tb.start), parseTime(tb.end)]);
        for (let t = parseTime(slot.min); t + 30 <= parseTime(slot.max); t += 30) {
          const isBlocked = blockedTimesForDate.some(([start, end]) => t >= start && t < end);
          if (!isBlocked) {
            const opt = document.createElement('option');
            opt.value = fmtTime(t); opt.textContent = fmtTime(t);
            timeEl.appendChild(opt);
          }
        }
        timeLbl.style.display = timeEl.style.display = 'block';
      }
    });
  });

  document.getElementById('bookingForm').addEventListener('submit', async e => {
    e.preventDefault();
    const student = document.getElementById('student').value;
    const program = programEl.value;
    const coach   = coachEl.value || '';
    let date;
    if (program.includes('Week Pass')) date = weekStartInput.value;
    else if (program.includes('Day Pass')) date = campDayInput.value;
    else date = dateEl.value;
    const time  = timeEl.value;
    const email = document.getElementById('email').value;
    const phone = document.getElementById('phone').value;
    const paymentOption = document.querySelector('input[name="paymentOption"]:checked').value;

    try {
      if (paymentOption === 'payNow') {
        const res = await fetch('/api/create-payment', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify({ student, email, phone, program, coach, date, time })
        });
        if (!res.ok) {
            let errorMsg = 'Payment failed. Please try again.';
            try {
                const errorData = await res.json();
                if (errorData && errorData.message) {
                    errorMsg = errorData.message;
                } else if (res.statusText) {
                    errorMsg = res.statusText;
                }
            } catch (e) { /* ignore parsing error */ }
            throw new Error(errorMsg);
        }
        const { url } = await res.json();
        window.location.href = url;
      } else if (paymentOption === 'payLater') {
        const payLaterBody = { student, email, phone, program, coach, date, time };
        const payLaterRes = await fetch('/api/book-pay-later', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          credentials: 'include',
          body: JSON.stringify(payLaterBody)
        });
        if (!payLaterRes.ok) {
          let errorMsg = 'Booking for pay later failed. Please try again.';
          try {
              const errorData = await payLaterRes.json();
              if (errorData && errorData.message) {
                  errorMsg = errorData.message;
              } else if (payLaterRes.statusText) {
                  errorMsg = payLaterRes.statusText;
              }
          } catch (e) { /* ignore parsing error, use generic message */ }
          throw new Error(errorMsg);
        }
        window.location.href = 'pay-later-success.html';
      }
    } catch (err) {
      console.error('Booking/Payment error:', err.message); // Log the actual error message
      alert(err.message); // Show more specific error to user
    }
  });
</script>

<!-- SCRIPT FOR MOBILE MENU, CHECK-SESSION, LOGOUT (Adapted for new structure) -->
<script>
document.addEventListener('DOMContentLoaded', () => {
    // --- Mobile Menu Toggle Script (Adapted from index.html) ---
    const menuToggle = document.querySelector('.mobile-menu-toggle');
    const mobileMenuClose = document.querySelector('.mobile-menu-close');
    // The main <nav> element is now the one that gets the 'mobile-menu--open' class
    const mainNavElement = document.querySelector('nav.main-navigation'); 

    if (menuToggle && mainNavElement && mobileMenuClose) {
        menuToggle.addEventListener('click', () => {
            const isMenuOpen = mainNavElement.classList.toggle('mobile-menu--open');
            menuToggle.setAttribute('aria-expanded', String(isMenuOpen));
            // Optional: Change hamburger to X and back if desired (not in index.html script)
            // menuToggle.innerHTML = isMenuOpen ? '&times;' : '&#9776;';
        });

        mobileMenuClose.addEventListener('click', () => {
            mainNavElement.classList.remove('mobile-menu--open');
            menuToggle.setAttribute('aria-expanded', 'false');
            // menuToggle.innerHTML = '&#9776;';
        });
    }

    // Close mobile menu when a nav link is clicked (Adapted from index.html)
    const mobileNavLinks = document.querySelectorAll('.mobile-menu-container ul.nav-links-mobile li a');
    if (mainNavElement && mobileNavLinks.length > 0) {
        mobileNavLinks.forEach(link => {
            link.addEventListener('click', () => {
                if (mainNavElement.classList.contains('mobile-menu--open')) {
                    mainNavElement.classList.remove('mobile-menu--open');
                    if(menuToggle) menuToggle.setAttribute('aria-expanded', 'false');
                    // if(menuToggle) menuToggle.innerHTML = '&#9776;';
                }
            });
        });
    }

    // --- Updated checkSession and logout functions (Content largely same, targets updated) ---
    async function checkSession() {
        const existingGreeting = document.querySelector('div.welcome-greeting'); 
        if (existingGreeting) existingGreeting.remove();

        const emailContainer = document.getElementById('email-container');
        const emailInput = document.getElementById('email');
        const phoneContainer = document.getElementById('phone-container');
        const phoneInput = document.getElementById('phone');

        try {
            const res = await fetch('/api/check-session', { credentials: 'include' });
            const data = await res.json();

            const authContainerDesktop = document.getElementById('authContainerDesktop'); // Targets .auth-buttons-desktop
            const authContainerMobile = document.getElementById('authContainerMobile');   // Targets .auth-buttons-mobile

            // Default logged-out HTML now includes the "Meet the Coaches" link for desktop
            const loggedOutDesktopHTML = `
                <a href="register.html"><button>Register</button></a>
                <a href="login.html"><button>Login</button></a>
                <a href="about.html#meet-our-coaches" class="coach-link-button">Meet the Coaches</a>
            `;
            const loggedOutMobileHTML = `
                <a href="register.html"><button>Register</button></a>
                <a href="login.html"><button>Login</button></a>
            `;

            if (data && data.loggedIn) {
                if (emailContainer) { emailContainer.style.display = 'none'; if(emailInput) emailInput.required = false; }
                if (phoneContainer) { phoneContainer.style.display = 'none'; if(phoneInput) phoneInput.required = false; }

                const portal = data.isAdmin ? 'admin.html'
                             : data.isCoach ? 'instructor_portal.html'
                             : 'parent_portal.html';
                const portalName = data.isAdmin ? 'Admin Portal'
                               : data.isCoach ? 'Instructor Portal'
                               : 'Parent Portal';

                // Logged-in HTML for desktop also includes "Meet the Coaches"
                const loggedInDesktopHTML = '<a href="' + portal + '"><button>' + portalName + '</button></a>' +
                                            '<button onclick="logout()">Logout</button>' +
                                            '<a href="about.html#meet-our-coaches" class="coach-link-button">Meet the Coaches</a>';
                
                const loggedInMobileHTML = '<a href="' + portal + '"><button>' + portalName + '</button></a>' +
                                           '<button onclick="logout()">Logout</button>';

                if (authContainerDesktop) authContainerDesktop.innerHTML = loggedInDesktopHTML;
                if (authContainerMobile) authContainerMobile.innerHTML = loggedInMobileHTML;

                if (data.firstName) {
                    const welcomeMessageText = 'Welcome, ' + data.firstName + '!';
                    const greeting = document.createElement('div');
                    greeting.className = 'welcome-greeting'; 
                    greeting.textContent = welcomeMessageText;
                    // greeting.style.cssText is now handled by the .welcome-greeting class in <style>
                    
                    const existingGreeting = document.querySelector('div.welcome-greeting'); 
                    if (existingGreeting) existingGreeting.remove();

                    if(document.body.firstChild && document.body.firstChild.nodeName !== 'SCRIPT' && document.body.firstChild.nodeName !== 'LINK') {
                        document.body.insertBefore(greeting, document.body.firstChild);
                    } else {
                        // Fallback if firstChild is script/link or body is empty
                        const mainContentArea = document.querySelector('main') || document.body;
                        mainContentArea.parentNode.insertBefore(greeting, mainContentArea);
                    }
                }
            } else {
                if (authContainerDesktop) authContainerDesktop.innerHTML = loggedOutDesktopHTML;
                if (authContainerMobile) authContainerMobile.innerHTML = loggedOutMobileHTML;
                if (emailContainer) { emailContainer.style.display = 'block'; if(emailInput) emailInput.required = true; }
                if (phoneContainer) { phoneContainer.style.display = 'block'; if(phoneInput) phoneInput.required = true; }
            }
        } catch (err) {
            console.error('Session check failed:', err);
            if (emailContainer) emailContainer.style.display = 'block';
            if (emailInput) emailInput.required = true;
            if (phoneContainer) phoneContainer.style.display = 'block';
            if (phoneInput) phoneInput.required = true;

            const authContainerDesktop = document.getElementById('authContainerDesktop');
            const authContainerMobile = document.getElementById('authContainerMobile');
            const loggedOutDesktopHTML = `
                <a href="register.html"><button>Register</button></a>
                <a href="login.html"><button>Login</button></a>
                <a href="about.html#meet-our-coaches" class="coach-link-button">Meet the Coaches</a>
            `;
            const loggedOutMobileHTML = `
                <a href="register.html"><button>Register</button></a>
                <a href="login.html"><button>Login</button></a>
            `;
            if (authContainerDesktop) authContainerDesktop.innerHTML = loggedOutDesktopHTML;
            if (authContainerMobile) authContainerMobile.innerHTML = loggedOutMobileHTML;
        }
    }

    window.logout = function() { // Ensure logout is global
        fetch('/api/logout', { method: 'POST', credentials: 'include' })
            .then(() => {
                const existingGreeting = document.querySelector('div.welcome-greeting');
                if (existingGreeting) existingGreeting.remove();
                document.cookie = "userFirstName=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"; // Keep old cookie cleanup
                location.reload();
            })
            .catch(err => {
                console.error('Logout failed:', err);
                location.reload();
            });
    }

    checkSession();
});
</script>
   <script>
     document.addEventListener('DOMContentLoaded', () => {
       const payNowRadio = document.getElementById('payNow');
       const payLaterRadio = document.getElementById('payLater');
       const submitButton = document.getElementById('submitBookingBtn');

       if (payNowRadio && payLaterRadio && submitButton) {
         const updateButtonText = () => {
           if (payLaterRadio.checked) {
             submitButton.innerHTML = 'Book (Pay Later)';
           } else {
             submitButton.innerHTML = 'Pay &amp; Book';
           }
         };
         payNowRadio.addEventListener('change', updateButtonText);
         payLaterRadio.addEventListener('change', updateButtonText);
       }
     });
   </script>
</body>
</html>
